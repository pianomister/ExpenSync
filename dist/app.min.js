"use strict";function createLocalDatabase(){var e=[{key:"db_version",value:window.globals.properties.version,description:"Version of created database"},{key:"ui_lang",value:"EN",description:"Language"},{key:"ui_money_format",value:"comma",description:"Money Format"},{key:"sync_enabled",value:!0,description:"Sync enabled"},{key:"sync_startup",value:!1,description:"Sync on startup"},{key:"sync_continuous",value:!0,description:"Sync continuously or only manually"},{key:"sync_lastupdate",value:1,description:"Timestamp of last sync"}];db.createTableWithData("settings",e),db.createTable("category",["uniqueid","timestamp","lastupdate","synchronized","description","icon","order","disabled"]);for(var t=(Date.now(),["Other","Groceries","Canteen","Eating Out","Fun","Clothing","Car","Transport","Travel","Household","Salary","Finance","Medical","Education","Rent / Loan","Communication"]),i=0;i<t.length;i++)db.insert("category",{uniqueid:createUniqueid(i,i,!0),timestamp:1,lastupdate:1,synchronized:!0,description:t[i],icon:i,order:i+1,disabled:!1});db.createTable("item",["uniqueid","timestamp","lastupdate","synchronized","account","category","price","description","deleted","version"]),db.createTableWithData("account",[{uniqueid:createUniqueid(1,"Default",!0),timestamp:1,lastupdate:0,synchronized:!1,description:"Default",initial_balance:0,order:1,disabled:!1}])}function deleteLocalDatabase(){expApp.confirm("This functionality is not available yet.","OK",function(){})}function getSettings(e){e=e||!1;var t=null;e&&(t={key:e});var n=db.query("settings",t),a=db.query("settings",null);if(console.debug("getSettings settingName",e,t,n,a),t)return n[0].value;var o={};for(i=0;i<n.length;i++)o[n[i].key]=n[i].value;return o}function setSettings(e,t){if(void 0!==t&&(e=[{key:e,value:t}]),e)for(i=0;i<e.length;i++)db.update("settings",{key:e[i].key},function(t){return t.value=e[i].value,t})}function getIcons(e){return 0!==e&&(e=e||!1),e||0===e?window.globals.icons[e]:window.globals.icons}function getAccounts(e){e=e||!1;var t=null;e&&(t={uniqueid:e});var n=db.queryAll("account",{query:t,sort:[["order","ASC"]]});if(t)return n[0];var a=[];for(i=0;i<n.length;i++)a.push(n[i]);return a}function getItemsFromTimerange(e,t,i){e=new Date(e).getTime(),t=new Date(t).getTime(),i=i||!1;for(var n=[],a=db.query("account",{disabled:!0}),o=0;o<a.length;o++)n.push(a[o].uniqueid);var r=db.queryAll("item",{query:function(i){return!i.deleted&&i.timestamp>=e&&i.timestamp<t&&n.indexOf(i.account)===-1}});if(i){for(var c=0,o=0;o<r.length;o++)c+=r[o].price;return c}return r}function getEntriesNewerThan(e,t,i){for(var n=[],a=0;a<e.length;a++){var o=db.query(i,{uniqueid:e[a].uniqueid});e[a].lastupdate>=t&&(0==o.length||o[0].lastupdate<=t)&&n.push(e[a])}return n}function chunkString(e,t){for(var i,n=Math.ceil(e.length/t),a=new Array(n),o=0;o<n;o++)i=o*t,a[o]=e.substring(i,i+t);return a}function createCSVDataLink(e,t,i,n){n=n||!1;var a="";a+=i+"\r\n\n";var o=db.tableFields(e),r=o.join();a+=r+"\r\n";var c=convertJSONtoCSV(t);return 0!=c.length&&(a+=c,n||(a="data:text/csv;charset=utf-8,"+escape(a)),a)}function convertJSONtoCSV(e){for(var t="object"!=("undefined"==typeof e?"undefined":_typeof(e))?JSON.parse(e):e,i="",n=0;n<t.length;n++){var a="";for(var o in t[n])a+='"'+t[n][o]+'",';i+=a.slice(0,a.length-1)+"\r\n"}return i}function getBalanceFromTimerange(e,t){return getItemsFromTimerange(e,t,!0)}function getTotalBalance(){for(var e=0,t=[],i=getAccounts(),n=0;n<i.length;n++)i[n].disabled?t.push(i[n].uniqueid):e+=i[n].initial_balance;for(var a=db.queryAll("item",{query:function(e){return!e.deleted&&t.indexOf(e.account)===-1}}),n=0;n<a.length;n++)e+=a[n].price;return e}function getAccountBalance(e){var t=db.queryAll("item",{query:{account:e,deleted:!1}}),i=getAccounts(e).initial_balance,n=0;console.debug("getAccountBalance",e,t.length,t);for(var a=0;a<t.length;a++)n+=t[a].price;return n+i}function onStatsDateChange(e){var t,i=$(e.delegateTarget).val();t=void 0==i||null==i||0==i.length||NaN==Date.parse(i)?0:Date.parse(i),"form-stats-date-start"==$(e.delegateTarget).attr("id")?Charts.filter.timestamp.start=t:Charts.filter.timestamp.end=t,Charts.draw()}function syncInit(){expApp.showPreloader("Sync with Dropbox ..."),getSettings("sync_enabled")?(window.client||(window.client=new Dropbox.Client({key:DROPBOX_APP_KEY})),window.client.authenticate(null,function(e){e?expApp.alert(e):syncSetup()})):(expApp.hidePreloader(),expApp.alert("Please enable sync in settings first before using it."))}function syncSetup(){window.globals.properties.debug&&console.log("syncSetup"),window.client&&window.client.isAuthenticated()?ds?(window.globals.properties.debug&&console.log("syncSetup/else"),window.setTimeout(function(){sync()},1e3)):client.getDatastoreManager().openDefaultDatastore(function(e,t){e?expApp.alert("Sync error when opening default datastore: "+e):(ds=t,dsTable=ds.getTable("sync"),window.setTimeout(function(){sync()},1e3))}):(expApp.hidePreloader(),expApp.alert("Sync failed because you are not authenticated with Dropbox yet."))}function syncSignOut(){window.client||(window.client=new Dropbox.Client({key:DROPBOX_APP_KEY})),window.client.authenticate(null,function(e){e?expApp.alert(e):client.isAuthenticated()&&client.signOut()})}function getSyncTime(){return!!ds&&ds.getModifiedTime()}function sync(){window.globals.properties.debug&&console.log("sync");var e=getSettings("sync_lastupdate"),t=dsTable.getOrInsert("sync",{name:"items",json:"[]"}),n=dsTable.getOrInsert("sync2",{name:"items2",json:""}),a=dsTable.getOrInsert("sync3",{name:"items3",json:""}),o=JSON.parse(t.get("json")+n.get("json")+a.get("json"));if(o.length>0)if(e<getSyncTime().getTime()){var r=getEntriesNewerThan(o,e,"item");for(window.globals.properties.debug&&console.log("Merge input: "+r),i=0;i<r.length;i++)db.insertOrUpdate("item",{uniqueid:r[i].uniqueid},r[i]);db.update("item",{synchronized:!1},function(e){return e.lastupdate=Date.now(),e.synchronized=!0,e}),db.commit()}else window.globals.properties.debug&&console.log("Everything is up to date.");syncItems=JSON.stringify(db.query("item")),itemChunks=chunkString(syncItems,Math.ceil(syncItems.length/3)),dsTable.query({name:"items"})[0].update({json:itemChunks[0]}),dsTable.query({name:"items2"})[0].update({json:itemChunks[1]}),dsTable.query({name:"items3"})[0].update({json:itemChunks[2]});var t=dsTable.getOrInsert("category",{name:"category",json:"[]"}),o=JSON.parse(t.get("json"));if(o.length>0)if(e<getSyncTime().getTime()){var r=getEntriesNewerThan(o,e,"category");for(window.globals.properties.debug&&console.log("Merge input: "+r),i=0;i<r.length;i++)db.insertOrUpdate("category",{uniqueid:r[i].uniqueid},r[i]);db.update("category",{synchronized:!1},function(e){return e.lastupdate=Date.now(),e.synchronized=!0,e}),db.commit()}else window.globals.properties.debug&&console.log("Everything is up to date.");dsTable.query({name:"category"})[0].update({json:JSON.stringify(db.query("category"))});var t=dsTable.getOrInsert("account",{name:"account",json:"[]"}),o=JSON.parse(t.get("json"));if(o.length>0)if(e<getSyncTime().getTime()){var r=getEntriesNewerThan(o,e,"account");for(window.globals.properties.debug&&console.log("Merge input: "+r),i=0;i<r.length;i++)db.insertOrUpdate("account",{uniqueid:r[i].uniqueid},r[i]);db.update("account",{synchronized:!1},function(e){return e.lastupdate=Date.now(),e.synchronized=!0,e}),db.commit()}else window.globals.properties.debug&&console.log("Everything is up to date.");dsTable.query({name:"account"})[0].update({json:JSON.stringify(db.query("account"))}),setSettings("sync_lastupdate",Date.now()),pageIndexLeft.trigger(),pageIndex.trigger(),expApp.hidePreloader()}function createUniqueid(e,t,i){i=i||!1;var n=""+e+t;return i||(n+=navigator.userAgent),calcMD5(n)}function getFormattedPrice(e){return e=parseFloat(e).toFixed(2),money_format=getSettings("ui_money_format"),"comma"===money_format&&(e=e.replace(".",",")),e}function formatPrice(e,t){t=t||!1,colorClass="red",e>=0&&(colorClass="green"),formattedPrice=getFormattedPrice(e);var i="";return t&&(t=getAccounts(t),t.disabled&&(colorClass="gray"),db.rowCount("account")>1&&(i='<br><span class="item-subtitle color-gray">'+t.description+"</span>")),'<span class="color-'+colorClass+'">'+formattedPrice+i+"</span>"}function formatDate(e,t){return t=t||!1,date=new Date(e),day=date.getDate(),1==(day+"").length&&(day="0"+day),month=date.getMonth()+1,1==(month+"").length&&(month="0"+month),hours=date.getHours(),1==(hours+"").length&&(hours="0"+hours),minutes=date.getMinutes(),1==(minutes+"").length&&(minutes="0"+minutes),t?date.getFullYear()+"-"+month+"-"+day+"T"+hours+":"+minutes:day+"."+month+"."+date.getFullYear()+" "+hours+":"+minutes}function createCategoryOptions(e,t,n,a){t=t||!1,n=n||!1,a=a||!1;var o=$(e),r=$("<div />");o.empty(),n&&o.append($("<option>").val(0).text("All"));var c={disabled:!1};a&&(c=null);var s=db.queryAll("category",{query:c,sort:[["order","ASC"]]});for(i=0;i<s.length;i++){var l=$("<option>").val(s[i].uniqueid).text(s[i].description);t&&t==s[i].uniqueid&&l.attr("selected","selected"),r.append(l)}o.append(r.html())}function createAccountOptions(e,t,n,a){t=t||!1,n=n||!1,a=a||!1;var o=$(e),r=$("<div />");o.empty(),n&&o.append($("<option>").val(0).text("All"));var c={disabled:!1};a&&(c=null);var s=db.queryAll("account",{query:c,sort:[["order","ASC"]]});for(i=0;i<s.length;i++){var l=$("<option>").val(s[i].uniqueid).text(s[i].description);t&&t==s[i].uniqueid&&l.attr("selected","selected"),r.append(l)}o.append(r.html())}function validateItemForm(e,t,i,n,a,o){var r,c,s,l,d,u;if(o=o||!1,0!=e&&null!=e&&NaN!=parseFloat(e)&&0!=e.length){if(r=parseFloat(e),c=t,s=i.replace('"',"'"),u="true"==o,d=a,a.length>1&&t.length>1){l=void 0==n||null==n||0==n.length||NaN==Date.parse(n)?Date.now():Date.parse(n);var p={price:r,category:c,description:s,date:l,deleted:u,account:d};return p}expApp.alert("Please select an account and a category.")}else expApp.alert("Please fill in a cost.");return!1}function createItemListElements(e,t,n,a,o,r,c,s){o=o||!1,r=r||!1,s=s||!1,$list=$("<ul />"),o&&($balance=$(o));for(var l=0,d=window.globals.temp[c],u=db.queryAll("category",{sort:[["order","ASC"]]}),p={},g=0;g<u.length;g++)p[u[g].uniqueid]=u[g];for(items=db.queryAll("item",{query:t,sort:n,limit:a}),s&&(d.infiniteScroll={endReached:!1,lastIndex:0},items.length<=window.globals.static.infiniteScrollItemsPerLoad&&(expApp.detachInfiniteScroll(".infinite-scroll-"+c),$(d.container).find(".infinite-scroll-preloader").remove())),i=0;i<items.length;i++){var m=items[i];if(l+=m.price,i>=d.infiniteScroll.lastIndex&&i<d.infiniteScroll.lastIndex+window.globals.static.infiniteScrollItemsPerLoad){var f=p[m.category],h=m.description,y=" | "+f.description;null!=h&&0!=h.length||(h='<span class="color-gray">'+f.description+"</span>",y="");var v='<a class="swipeout-delete swipeout-overswipe" data-confirm="Are you sure that you want to delete this item?" href="">Delete</a>';r&&(v=""),$list.append('<li class="swipeout" data-uniqueid="'+m.uniqueid+'" data-tempid="'+c+'">\t<div class="swipeout-content item-content">\t\t<div class="item-media">\t\t\t<span class="icon-wrap"><i class="color-black icon ion '+getIcons(f.icon)+'"></i></span>\t\t</div>\t\t<div class="item-inner">\t\t\t<div class="item-title-row">\t\t\t\t<div class="item-title">'+h+'</div>\t\t\t\t<div class="item-after">'+formatPrice(m.price,m.account)+'\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="item-subtitle color-gray">'+formatDate(m.timestamp)+y+'</div>\t\t</div>\t</div>\t<div class="swipeout-actions-right">\t\t<a href="" class="edit-item" data-uniqueid="'+m.uniqueid+'" data-tempid="'+c+'">Edit</a>'+v+"\t</div></li>")}}d.infiniteScroll.lastIndex=d.infiniteScroll.lastIndex+window.globals.static.infiniteScrollItemsPerLoad,d.infiniteScroll.lastIndex>items.length&&(d.infiniteScroll.endReached=!0),s&&$(e).empty(),$(e).append($list.html()),o&&$balance.html(formatPrice(l)),$$(".page-expenses-list .edit-item").on("click",function(e){var t=$(e.target).attr("data-uniqueid"),i=$(e.target).attr("data-tempid"),n=db.query("item",{uniqueid:t})[0];$(".popup-edit-item").attr("data-uniqueid",t),$(".popup-edit-item").attr("data-tempid",i),$(".popup-edit-item #form-edit-price").val(n.price),$(".popup-edit-item #form-edit-description").val(n.description),$(".popup-edit-item #form-edit-date").val(formatDate(n.timestamp,!0)),$(".popup-edit-item").attr("data-deleted",n.deleted),createCategoryOptions($(".popup-edit-item #form-edit-category"),n.category,!1,!0),createAccountOptions($(".popup-edit-item #form-edit-account"),n.account,!1,!0),n.deleted?($(".popup-edit-item #form-edit-restore").show(),$(".popup-edit-item #form-edit-restore").on("click",function(e){$(".popup-edit-item").attr("data-deleted",!1),$(".popup-edit-item-save").click()})):$(".popup-edit-item #form-edit-restore").hide(),$(".popup-edit-item-save").on("click",function(e){e.preventDefault();var t=$(".popup-edit-item").attr("data-uniqueid"),i=$(".popup-edit-item").attr("data-tempid");if(t.length>1){var n=$(".popup-edit-item #form-edit-price").val(),a=$(".popup-edit-item #form-edit-category").val(),o=$(".popup-edit-item #form-edit-description").val(),r=$(".popup-edit-item #form-edit-date").val(),c=$(".popup-edit-item").attr("data-deleted"),s=$(".popup-edit-item #form-edit-account").val(),l=validateItemForm(n,a,o,r,s,c);l&&(db.update("item",{uniqueid:t},function(e){return e.price=l.price,e.category=l.category,e.account=l.account,e.description=l.description,e.timestamp=l.date,e.deleted=l.deleted,e.lastupdate=Date.now(),e.synchronized=!1,e.version=window.globals.properties.version,e}),expApp.closeModal(".popup-edit-item"),updateItemList($(d.container).find("#expenses-list-category").val(),i,!0),pageIndexLeft.trigger(),pageIndex.trigger())}}),expApp.popup(".popup-edit-item")}),$$(".page-expenses-list .swipeout").on("deleted",function(e){delID=$(e.target).attr("data-uniqueid"),console.log("deleted item ",delID),db.update("item",{uniqueid:delID},function(e){return e.deleted=!0,e.lastupdate=Date.now(),e.synchronized=!1,e}),delItem=db.query("item",{uniqueid:delID}),delItemCategory=db.query("category",{uniqueid:delItem[0].category}),notificationDescription="",null!=delItem[0].description&&0!=delItem[0].description.length&&(notificationDescription=": "+delItem[0].description),pageIndexLeft.trigger(),pageIndex.trigger(),expApp.addNotification({title:"Item removed",message:formatPrice(delItem[0].price)+'</span> for <span class="color-blue">'+delItemCategory[0].description+"</span>"+notificationDescription,hold:1e3})})}function createCategoryListElements(e){$list=$(e).empty();for(var t=db.queryAll("category",{sort:[["order","ASC"]]}),i=0;i<t.length;i++){var n=t[i],a=n.disabled?"":' checked="checked"';$list.append('<li class="swipeout" data-uniqueid="'+n.uniqueid+'">\t<label class="label-checkbox swipeout-content item-content disabled">\t\t<input type="checkbox" id="cat-'+n.uniqueid+'"'+a+'>\t\t<div class="item-media">\t\t\t<i class="icon icon-form-checkbox"></i>\t\t</div>\t\t<div class="item-inner">\t\t\t<div class="item-title">'+n.description+'</div>\t\t\t<div class="item-after">\t\t\t\t<i class="icon ion '+getIcons(n.icon)+'"></i>\t\t\t</div>\t\t</div>\t</label>\t<div class="sortable-handler"></div>\t<div class="swipeout-actions-right">\t\t<a href="#" class="edit-category" data-uniqueid="'+n.uniqueid+'">Edit</a>\t</div></li>')}$list.append('<li><a class="item-link list-button" id="settings-categories-add">Add category</a></li>'),$(e).find(".edit-category").on("click",function(e){var t=$(e.target).attr("data-uniqueid");openCategoryPopup(t)}),$("#settings-categories-add").on("click",function(t){t.preventDefault();var i=createUniqueid(Date.now(),"New Category"+Date.now());db.insert("category",{uniqueid:i,timestamp:Date.now(),lastupdate:Date.now(),synchronized:!1,description:"New Category",icon:0,order:99,disabled:!1}),openCategoryPopup(i),createCategoryListElements(e)})}function createAccountListElements(e){$list=$(e).empty();for(var t=db.queryAll("account",{sort:[["order","ASC"]]}),i=0;i<t.length;i++){var n=t[i],a=n.disabled?"":' checked="checked"';$list.append('<li class="swipeout" data-uniqueid="'+n.uniqueid+'">\t<label class="label-checkbox swipeout-content item-content disabled">\t\t<input type="checkbox" id="cat-'+n.uniqueid+'"'+a+'>\t\t<div class="item-media">\t\t\t<i class="icon icon-form-checkbox"></i>\t\t</div>\t\t<div class="item-inner">\t\t\t<div class="item-title">'+n.description+'</div>\t\t\t<div class="item-after">'+formatPrice(n.initial_balance)+'\t\t\t</div>\t\t</div>\t</label>\t<div class="sortable-handler"></div>\t<div class="swipeout-actions-right">\t\t<a href="#" class="edit-category" data-uniqueid="'+n.uniqueid+'">Edit</a>\t</div></li>')}$list.append('<li><a class="item-link list-button" id="settings-accounts-add">Add account</a></li>'),$(e).find(".edit-category").on("click",function(e){var t=$(e.target).attr("data-uniqueid");openAccountPopup(t)}),$("#settings-accounts-add").on("click",function(t){t.preventDefault();var i=createUniqueid(Date.now(),"New Account"+Date.now());db.insert("account",{uniqueid:i,timestamp:Date.now(),lastupdate:Date.now(),synchronized:!1,description:"New Account",initial_balance:0,order:99,disabled:!1}),openAccountPopup(i),createAccountListElements(e)})}function updateItemList(e,t,i){e=e||0,i=i||!1,page=window.globals.temp[t];var n={deleted:!1},a=[["timestamp","DESC"]],o=null,r=$(page.container).find("#expenses-list-balance"),c=!1;switch(0!=e&&(n.category=e),page.query.request){case"timerange":if(null==page.query.start||null==page.query.end){o=50,page.query.title="Latest by date (error)";break}n=function(t){return!t.deleted&&t.timestamp>=page.query.start&&t.timestamp<page.query.end&&(0==e||t.category==e)};break;case"deleted":n.deleted=!0,a=[["lastupdate","DESC"]],o=50,r=!1,c=!0,page.query.title="Last deleted";break;case"lastupdate":a=[["lastupdate","DESC"]],o=50,r=!1,page.query.title="Last updated";break;case"latest":default:o=50,r=!1,page.query.title="Latest by date"}$(page.navbarInnerContainer).find("#expenses-list-title").html(page.query.title.replace("+"," ")),console.debug("updateItemList query",n),createItemListElements($(page.container).find("#expenses-list-items"),n,a,o,r,c,t,i)}function openCategoryPopup(e){var t=db.query("category",{uniqueid:e})[0];$(".popup-edit-category").attr("data-uniqueid",e),$(".popup-edit-category #form-category-description").val(t.description),$(".popup-edit-category #form-category-icon").empty();for(var i=getIcons(),n=0;n<i.length;n++){var a="";n==t.icon&&(a=' class="icon-selected"'),$(".popup-edit-category #form-category-icon").append('<li data-id="'+n+'"'+a+'><i class="'+i[n]+'"></i></li>')}$(".popup-edit-category #form-category-icon li").on("click",function(e){$(e.delegateTarget).addClass("icon-selected"),$(e.delegateTarget).siblings().removeClass("icon-selected")}),$(".popup-edit-category-save").on("click",function(e){e.preventDefault();var t=$(".popup-edit-category").attr("data-uniqueid");if(t.length>1){var i=$(".popup-edit-category #form-category-description").val(),n=$(".popup-edit-category #form-category-icon li.icon-selected").attr("data-id");i.length>0&&n.length>0?(db.update("category",{uniqueid:t},function(e){return e.description=i,e.icon=n,e.synchronized=!1,e.lastupdate=Date.now(),e}),createCategoryListElements("#settings-categories-list"),expApp.closeModal(".popup-edit-category")):expApp.alert("Please fill in a description and choose an icon.")}else expApp.alert("Could not save: no ID found. Please cancel and try again.")}),expApp.popup(".popup-edit-category")}function openAccountPopup(e){var t=db.query("account",{uniqueid:e})[0];$(".popup-edit-account").attr("data-uniqueid",e),$(".popup-edit-account #form-account-description").val(t.description),$(".popup-edit-account #form-account-balance").val(t.initial_balance),$(".popup-edit-account-save").on("click",function(e){e.preventDefault();var t=$(".popup-edit-account").attr("data-uniqueid");if(t.length>1){var i=$(".popup-edit-account #form-account-description").val(),n=parseFloat($(".popup-edit-account #form-account-balance").val());i.length>0&&(""+n).length>0&&NaN!=n?(db.update("account",{uniqueid:t},function(e){return e.description=i,e.initial_balance=n,e.synchronized=!1,e.lastupdate=Date.now(),e}),createAccountListElements("#settings-accounts-list"),pageIndex.trigger(),expApp.closeModal(".popup-edit-account")):expApp.alert("Please fill in a description and an initial balance.")}else expApp.alert("Could not save: no ID found. Please cancel and try again.")}),expApp.popup(".popup-edit-account")}function createDatetimePicker(e,t){var i=new Date;e||(e=i);var n=expApp.picker({input:t,toolbar:!1,inputReadOnly:!0,rotateEffect:!1,value:[e.getMonth(),e.getDate(),e.getFullYear(),e.getHours(),e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()],onChange:function(e,t,i){var n=new Date(e.value[2],1*e.value[0]+1,0).getDate();t[1]>n&&e.cols[1].setValue(n)},formatValue:function(e,t,i){var n=parseInt(t[1])+1;return t[2]+"-"+(n<10?"0"+n:n)+"-"+(t[0]<10?"0"+t[0]:t[0])+"T"+t[3]+":"+t[4]},cols:[{values:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],textAlign:"right",cssClass:"smaller"},{divider:!0,content:".",cssClass:"smaller"},{values:[0,1,2,3,4,5,6,7,8,9,10,11],displayValues:[1,2,3,4,5,6,7,8,9,10,11,12],textAlign:"right",cssClass:"smaller"},{divider:!0,content:".",cssClass:"smaller"},{values:function(){for(var t=[],n=(e.getFullYear()<i.getFullYear()?e.getFullYear():i.getFullYear())-5;n<=(e.getFullYear()>i.getFullYear()?e.getFullYear():i.getFullYear())+5;n++)t.push(n);return t}(),cssClass:"smaller"},{divider:!0,content:" ",cssClass:"smaller"},{values:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],cssClass:"smaller"},{divider:!0,content:":",cssClass:"smaller"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}(),cssClass:"smaller"}]});return n}function initApp(){pageIndexLeft=expApp.onPageInit("index-left",function(e){var t=(new Date).getMonth(),i=(new Date).getFullYear(),n=new Date(i,t,1,0,0,0,0),a=new Date(i,t,1,0,0,0,0);$("#menu-list").empty();for(var o=!1,r=15;r>=0;r--){n.setFullYear(i,t),a.setFullYear(i,t+1);var c=window.i18n.month[t]+" "+i,s={request:"timerange",start:n.getTime(),end:a.getTime(),title:c},l=0,d=getItemsFromTimerange(n.getTime(),a.getTime());if(d.length>0){o=!0;for(var u=0;u<d.length;u++)l+=d[u].price;$("#menu-list").append('<li><a href="expenses-list.html?'+$.param(s)+'" data-view=".view-main" class="item-link close-panel item-content">\t<div class="item-inner">\t\t<div class="item-title">'+c+'</div>\t\t<div class="item-after">'+formatPrice(l)+"</div></div></a></li>")}t--,t==-1&&(t=11,i--)}o?$("#menu-list").append('<li><a href="expenses-list.html?request=lastupdate" data-view=".view-main" class="item-link close-panel item-content">\t<div class="item-inner">\t\tLast updated</div></a></li><li><a href="expenses-list.html?request=latest" data-view=".view-main" class="item-link close-panel item-content">\t<div class="item-inner">\t\tLatest by date</div></a></li><li><a href="expenses-list.html?request=deleted" data-view=".view-main" class="item-link close-panel item-content">\t<div class="item-inner">\t\tLast deleted</div></a></li>'):$("#menu-list").append('<li><div class="item-content">\t<div class="item-inner">\t\tNo expenses added yet.</div></div></li>')}),pageIndex=expApp.onPageInit("index index-1",function(e){e=e||{container:".view-main"},createCategoryOptions($(e.container).find("#form-add-category")),createAccountOptions($(e.container).find("#form-add-account"),!1,!1,!0);var t=new Date;$(e.container).find("#form-add-submit").on("click",function(t){if(t.preventDefault(),!window.globals.state.blockedInput){that=$(t.target),that.addClass("disabled"),window.globals.state.blockedInput=!0,window.setTimeout(function(){that.removeClass("disabled"),window.globals.state.blockedInput=!1},1e3);var i=$(e.container).find("#form-add-price").val(),n=$(e.container).find("#form-add-category").val(),a=$(e.container).find("#form-add-description").val(),o=$(e.container).find("#form-add-date").val(),r=$(e.container).find("#form-add-account").val(),c=validateItemForm(i,n,a,o,r,!1);if(c){$(e.container).find("#form-add-price").val(""),$(e.container).find("#form-add-description").val(""),$(e.container).find("#form-add-date").val("");var s=(db.insert("item",{uniqueid:createUniqueid(Date.now(),o+a+i+n+r),timestamp:c.date,lastupdate:Date.now(),synchronized:!1,account:c.account,category:c.category,price:c.price,description:c.description,deleted:!1,version:window.globals.properties.version}),db.query("category",{uniqueid:n})),l="";null!=a&&0!=a.length&&(l=": "+a),expApp.addNotification({title:"Expense added",message:formatPrice(i)+' for <span class="color-blue">'+s[0].description+"</span>"+l,hold:1e3}),pageIndexLeft.trigger(),pageIndex.trigger()}}});var i=getTotalBalance();$(e.container).find("#total-balance").html(formatPrice(i));var n=t.getMonth(),a=t.getFullYear(),o=new Date(a,n,1,0,0,0,0),r=new Date(a,n+1,1,0,0,0,0),c=getBalanceFromTimerange(o,r);$(e.container).find("#total-balance-month").html(formatPrice(c));var s=i-c;$(e.container).find("#total-balance-lastmonth").html(formatPrice(s));var l=getAccounts();$(e.container).find("#index-account-balance").empty();for(var d=0;d<l.length;d++){var u=getAccountBalance(l[d].uniqueid);$(e.container).find("#index-account-balance").append('<li><div class="item-content">\t<div class="item-inner">\t\t<div class="item-title">'+l[d].description+'</div>\t\t<div class="item-after">'+formatPrice(u)+"</div>\t</div></div></li>")}}),expApp.onPageInit("expenses-list",function(e){console.debug("in expenses list");var t=createUniqueid(Date.now(),e.query.request);window.globals.temp[t]=e,$(e.container).find("#expenses-list-category").attr("data-temppage",t),createCategoryOptions($(e.container).find("#expenses-list-category"),!1,!0),$(e.container).find("#expenses-list-category").on("change",function(e){var t=$(e.delegateTarget).val(),i=$(e.delegateTarget).attr("data-temppage");updateItemList(t,i,!0),console.debug("change list category",e,t,i)}),$(e.container).find(".page-content").addClass("infinite-scroll-"+t),expApp.attachInfiniteScroll(".infinite-scroll-"+t),$(".infinite-scroll-"+t).on("infinite",function(){window.globals.state.infiniteScrollLoading||(window.globals.state.infiniteScrollLoading=!0,setTimeout(function(){window.globals.state.infiniteScrollLoading=!1;var e=window.globals.temp[t];return e.infiniteScroll.endReached?(expApp.detachInfiniteScroll(".infinite-scroll-"+t),void $(".infinite-scroll-"+t+" .infinite-scroll-preloader").remove()):void updateItemList($(e.container).find("#expenses-list-category").val(),t,!1)},100))}),updateItemList(0,t,!0)}),expApp.onPageInit("settings",function(e){var t=getSettings();console.log(t),$("#settings-ui_money_format").find('option[value="'+t.ui_money_format+'"]').attr("selected","selected"),t.sync_enabled&&$("#settings-sync_enabled").prop("checked","checked"),t.sync_startup&&$("#settings-sync_startup").prop("checked","checked"),$("#settings-ui_money_format").on("change",function(){setSettings("ui_money_format",$("#settings-ui_money_format").val()),console.log(getSettings("ui_money_format"))}),$("#settings-sync_enabled").on("change",function(){setSettings("sync_enabled",$("#settings-sync_enabled").is(":checked")),console.log(getSettings("sync_enabled"))}),$("#settings-sync_startup").on("change",function(){setSettings("sync_startup",$("#settings-sync_startup").is(":checked")),console.log(getSettings("sync_startup"))})}),expApp.onPageInit("settings-categories",function(e){createCategoryListElements("#settings-categories-list"),$$(".list-block.sortable").on("open",function(e){$(e.target).hasClass("sortable")&&($$(".toggle-sortable i").addClass("icon-ion-ios7-checkmark-outline").removeClass("icon-ion-ios7-drag"),$("#settings-categories-list label.label-checkbox").removeClass("disabled"))}),$$(".list-block.sortable").on("close",function(e){$(e.target).hasClass("sortable")&&($$(".toggle-sortable i").addClass("icon-ion-ios7-drag").removeClass("icon-ion-ios7-checkmark-outline"),$("#settings-categories-list label.label-checkbox").addClass("disabled"),$("#settings-categories-list li").each(function(e){if($(this).is("[data-uniqueid]")){var t=$(this).attr("data-uniqueid"),i=!$(this).find("#cat-"+t).is(":checked"),n=e+1;db.update("category",{uniqueid:t},function(e){return e.disabled=i,e.order=n,e.synchronized=!1,e.lastupdate=Date.now(),e})}}))})}),expApp.onPageInit("settings-accounts",function(e){createAccountListElements("#settings-accounts-list"),$$(".list-block.sortable").on("open",function(e){$(e.target).hasClass("sortable")&&($$(".toggle-sortable i").addClass("icon-ion-ios7-checkmark-outline").removeClass("icon-ion-ios7-drag"),$("#settings-accounts-list label.label-checkbox").removeClass("disabled"))}),$$(".list-block.sortable").on("close",function(e){$(e.target).hasClass("sortable")&&($$(".toggle-sortable i").addClass("icon-ion-ios7-drag").removeClass("icon-ion-ios7-checkmark-outline"),$("#settings-accounts-list label.label-checkbox").addClass("disabled"),$("#settings-accounts-list li").each(function(e){if($(this).is("[data-uniqueid]")){var t=$(this).attr("data-uniqueid"),i=!$(this).find("#cat-"+t).is(":checked"),n=e+1;db.update("account",{uniqueid:t},function(e){return e.disabled=i,e.order=n,e.synchronized=!1,e.lastupdate=Date.now(),e})}}),pageIndex.trigger())})}),expApp.onPageInit("backup",function(e){e=e||{container:".view-main"},$(e.container).find("a#export-csv").on("click",function(){var t=$(e.container).find("#export-table").val(),i=createCSVDataLink(t,db.query(t),"ExpenSync CSV Export "+Date.now());if(i){var n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","expensync_export_"+Date.now()+".csv"),n.setAttribute("class","external"),document.body.appendChild(n),n.click()}else expApp.alert("No data was found for export.")}),$(e.container).find("a#export-text-csv").on("click",function(){var t=$(e.container).find("#export-table").val();$(".popup-general .popup-title").html("CSV Export"),$(".popup-general .page-content").html('<div class="content-block-title">Text content</div><div class="list-block"><ul><li class="align-top"><div class="item-content"><div class="item-inner"><div class="item-input"><textarea style="height: 300px">'+createCSVDataLink(t,db.query(t),"ExpenSync CSV Export "+Date.now(),!0)+"</textarea></div></div></div></li></ul></div>"),expApp.popup(".popup-general")}),$(e.container).find("a#export-text-json").on("click",function(){var t=$(e.container).find("#export-table").val();$(".popup-general .popup-title").html("JSON Export"),$(".popup-general .page-content").html('<div class="content-block-title">Text content</div><div class="list-block"><ul><li class="align-top"><div class="item-content"><div class="item-inner"><div class="item-input"><textarea style="height: 300px">'+JSON.stringify(db.query(t))+"</textarea></div></div></div></li></ul></div>"),expApp.popup(".popup-general")}),$(e.container).find("a#form-import-json-submit").on("click",function(t){if(t.preventDefault(),!window.globals.state.blockedInput){that=$(t.target),that.addClass("disabled"),window.globals.state.blockedInput=!0,window.setTimeout(function(){that.removeClass("disabled"),window.globals.state.blockedInput=!1},1e3);var i=JSON.parse($(e.container).find("#form-import-json-data").val()),n=$(e.container).find("#form-import-table").val(),a={updated:0,created:0};i&&Array.isArray(i)&&i.forEach(function(e){delete e.ID;var t=db.queryAll(n,{query:{uniqueid:e.uniqueid}});console.debug("rowExists",t,e.uniqueid,e.description),t=1===t.length,t?(db.update(n,{uniqueid:e.uniqueid},function(t){return $.extend(t,e)}),a.updated+=1):(db.insert(n,e),a.created+=1)}),expApp.alert("The data import into <strong>"+n+"</strong> was completed. Updated <strong>"+a.updated+"</strong> existing entries, created <strong>"+a.created+"</strong> new entries.","Import completed")}})}),expApp.onPageInit("stats-chartist",function(e){
if($("#form-stats-date-start").on("change",onStatsDateChange),$("#form-stats-date-end").on("change",onStatsDateChange),Charts.draw(),window.globals.properties.debug)for(var t=db.query("item"),i=0;i<t.length;i++)row=t[i],$("#stats-item-list").append("<tr>  <td>"+row.uniqueid+"</td>  <td>"+row.timestamp+"</td>  <td>"+row.lastupdate+"</td>  <td>"+row.synchronized+"</td>  <td>"+row.account+"</td>  <td>"+row.category+"</td>  <td>"+row.price+"</td>  <td>"+row.description+"</td>  <td>"+row.deleted+"</td>  <td>"+row.version+"</td></tr>")}),expApp.onPageInit("stats",function(e){function t(e,t){return e.total+=t.price,e.count++,e.average=e.total/e.count,e}function i(e,t){return e.total-=t.price,e.count--,e.average=e.total/e.count,e}function n(){return{total:0,count:0,average:0}}var a=[],o=[],r=[],c=getAccounts(),s=0;c.forEach(function(e){r[e.uniqueid]=e.description,e.disabled?a.push(e.uniqueid):s+=e.initial_balance});var l=db.queryAll("item",{query:function(e){return!e.deleted&&a.indexOf(e.account)===-1}}),d=db.query("category");d.forEach(function(e){o[e.uniqueid]=e.description});var u=s;l.sort(function(e,t){return e.date<t.date?-1:e.date>t.date?1:0}),l.forEach(function(e){e.timestamp=new Date(e.timestamp),e.monthYear=d3.time.format("%Y/%m").parse(e.timestamp.getFullYear()+"/"+(e.timestamp.getMonth()+1)),u+=e.price,e.runningTotal=u});var p=crossfilter(l),g=p.groupAll(),m=p.dimension(dc.pluck("monthYear")),f=m.group().reduceSum(dc.pluck("price")),h=m.bottom(1)[0].timestamp,y=m.top(1)[0].timestamp,v=p.dimension(dc.pluck("timestamp")),b=v.group().reduce(t,i,n),w=v.group().reduceSum(dc.pluck("runningTotal"));p.groupAll();var x=p.dimension(dc.pluck("category")),q=x.group().reduceSum(function(e){return e.price<0?e.price:0}),k=x.group().reduceSum(function(e){return e.price>0?e.price:0}),A=x.groupAll().reduceSum(function(e){return e.price<0?e.price:0}),C=x.groupAll().reduceSum(function(e){return e.price>0?e.price:0});p.groupAll();var S=p.dimension(dc.pluck("account")),D=S.group().reduceSum(function(e){return e.price<0?e.price:0}),I=S.group().reduceSum(function(e){return e.price>0?e.price:0}),T=S.groupAll().reduceSum(function(e){return e.price<0?e.price:0}),P=S.groupAll().reduceSum(function(e){return e.price>0?e.price:0});dc.dataCount(".dc-data-count").dimension(p).group(g);var F=dc.barChart("#dc-month-chart"),_=dc.compositeChart("#dc-trend-chart"),E=dc.rowChart("#dc-category-minus-chart"),O=dc.rowChart("#dc-category-plus-chart"),L=dc.pieChart("#dc-category-minus-pie-chart"),N=dc.pieChart("#dc-category-plus-pie-chart"),M=dc.pieChart("#dc-account-minus-pie-chart"),z=dc.pieChart("#dc-account-plus-pie-chart"),Y=dc.dataTable("#dc-data-table"),j=d3.time.scale();j.domain([h,y]);var B=function(e){var t=e.value>0?C:A;return o[e.key]+": "+getFormattedPrice(Math.round(100*e.value)/100)+" ("+Math.round(e.value/t.value()*1e3)/10+" %)"},J=function(e){var t=e.value>0?P:T;return r[e.key]+": "+getFormattedPrice(Math.round(100*e.value)/100)+" ("+Math.round(e.value/t.value()*1e3)/10+" %)"},V=function(){$(".dc-category-total-minus-sum").text(getFormattedPrice(A.value())),$(".dc-category-total-plus-sum").text(getFormattedPrice(C.value())),$("#dc-account-total-minus-sum").text(getFormattedPrice(T.value())),$("#dc-account-total-plus-sum").text(getFormattedPrice(P.value()))};F.width(function(){return $("#dc-month-chart").width()}).height(200).margins({left:35,right:30,top:20,bottom:20}).dimension(m).group(f).x(j).xUnits(d3.time.months).elasticX(!0).elasticY(!0).colors(d3.scale.ordinal().domain(["positive","negative"]).range(["#4cd964","#ff3b30"])).colorAccessor(function(e){return e.value>0?"positive":"negative"}).brushOn(!0).round(d3.time.month.round).title(function(e){return e.key.getMonth()+1+"/"+e.key.getFullYear()+": "+getFormattedPrice(Math.round(100*e.value)/100)}).on("renderlet",function(e){V()}).yAxis().ticks(4),_.width(function(){return $("#dc-trend-chart").width()}).height(200).margins({left:35,right:30,top:20,bottom:20}).dimension(v).brushOn(!1).elasticX(!0).elasticY(!0).title(function(e){var t=e.key.getDay()+"."+(e.key.getMonth()+1)+"."+e.key.getFullYear()+":";return t+="object"===_typeof(e.value)?" expense for this day "+parseFloat(e.value.total).toFixed(2):" overall total balance "+parseFloat(e.value).toFixed(2)}).renderHorizontalGridLines(!0).x(d3.time.scale()).legend(dc.legend().x(40).y(20).gap(10)).compose([dc.lineChart(_).ordinalColors(["#ff9500"]).group(b,"Daily expense").valueAccessor(function(e){return e.value.average}),dc.lineChart(_).ordinalColors(["#4cd964"]).group(w,"Total balance")]).yAxis().ticks(4),E.width(function(){return $("#dc-category-minus-chart").width()}).height(500).margins({left:30,right:30,top:20,bottom:20}).dimension(x).group(q).label(function(e){return o[e.key]}).title(B).elasticX(!0).xAxis().ticks(4),O.width(function(){return $("#dc-category-plus-chart").width()}).height(500).margins({left:30,right:30,top:20,bottom:20}).dimension(x).group(k).label(function(e){return o[e.key]}).title(B).elasticX(!0).xAxis().ticks(4),L.width(function(){return $("#dc-category-minus-pie-chart").width()}).height(300).radius(115).dimension(x).group(q).label(function(e){return""}).title(B),L.onClick=function(){},N.width(function(){return $("#dc-category-plus-pie-chart").width()}).height(300).radius(115).dimension(x).group(k).label(function(e){return""}).title(B),N.onClick=function(){},M.width(function(){return $("#dc-account-minus-pie-chart").width()}).height(300).radius(115).dimension(S).group(D).label(function(e){return""}).title(J),z.width(function(){return $("#dc-account-plus-pie-chart").width()}).height(300).radius(115).dimension(S).group(I).label(function(e){return""}).title(J),Y.dimension(m).group(function(e){return e.timestamp.getFullYear()+" / "+("0"+(e.timestamp.getMonth()+1)).slice(-2)}).size(25).order(d3.descending).columns([{label:"Date",format:function(e){var t=("0"+e.timestamp.getDate()).slice(-2)+"."+("0"+(e.timestamp.getMonth()+1)).slice(-2)+"."+e.timestamp.getFullYear()+" "+("0"+e.timestamp.getHours()).slice(-2)+":"+("0"+e.timestamp.getMinutes()).slice(-2);return t}},{label:"Category",format:function(e){return o[e.category]}},{label:"Description",format:function(e){return e.description}},{label:"Price",format:function(e){return parseFloat(e.price).toFixed(2)}}]),dc.renderAll()}),expApp.init(),window.globals.properties.debug&&console.debug("DB content: ",JSON.parse(db.serialize()));var e=document.getElementById("button-install-firefox");if(navigator&&navigator.mozApps){var t,i;!function(){var n=function(e){e.preventDefault();var i=navigator.mozApps.install(t);i.onsuccess=function(e){expApp.alert("ExpenSync was successfully installed!")},i.onerror=function(){expApp.alert(i.error.name)}};t=location.href+"manifest.webapp",i=navigator.mozApps.checkInstalled(t),i.onsuccess=function(){i.result?e.style.display="none":e.addEventListener("click",n,!1)}}()}else e.style.display="none"}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};window.i18n={month:["January","February","March","April","May","June","July","August","September","October","November","December"],weekday:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},window.globals={properties:{version:"0.3",appname:"ExpenSync",appkey:"z0bumu7k3mv0nu3",developer:"Stephan Giesau",website:"http://www.stephan-giesau.de/",debug:!1},icons:["icon-ion-ios7-more","icon-ion-ios7-cart","icon-ion-fork","icon-ion-ios7-wineglass","icon-ion-ios7-musical-notes","icon-ion-ios7-pricetags","icon-ion-model-s","icon-ion-plane","icon-ion-map","icon-ion-ios7-home","icon-ion-ios7-briefcase","icon-ion-cash","icon-ion-ios7-medkit","icon-ion-university","icon-ion-ios7-home","icon-ion-ios7-telephone","icon-smile-o","icon-frown-o","icon-meh-o","icon-code","icon-question","icon-info","icon-anchor","icon-euro","icon-gbp","icon-dollar","icon-child","icon-ion-bag","icon-ion-beer","icon-ion-card","icon-ion-document-text","icon-ion-earth","icon-ion-female","icon-ion-game-controller-b","icon-ion-hammer","icon-ion-icecream","icon-ion-ios7-alarm","icon-ion-ios7-albums","icon-ion-ios7-americanfootball","icon-ion-ios7-baseball","icon-ion-ios7-bell","icon-ion-ios7-bolt","icon-ion-ios7-bookmarks","icon-ion-ios7-box","icon-ion-ios7-calendar","icon-ion-ios7-camera","icon-ion-ios7-chatboxes","icon-ion-ios7-chatbubble","icon-ion-ios7-checkmark-outline","icon-ion-ios7-cloud","icon-ion-ios7-cloudy-night","icon-ion-ios7-contact-outline","icon-ion-ios7-copy","icon-ion-ios7-drag","icon-ion-ios7-email","icon-ion-ios7-filing","icon-ion-ios7-flag","icon-ion-ios7-folder","icon-ion-ios7-football-outline","icon-ion-ios7-gear-outline","icon-ion-ios7-glasses","icon-ion-ios7-heart","icon-ion-ios7-lightbulb","icon-ion-ios7-location","icon-ion-ios7-locked","icon-ion-ios7-mic","icon-ion-ios7-monitor","icon-ion-ios7-paper","icon-ion-ios7-paperplane","icon-ion-ios7-partlysunny","icon-ion-ios7-paw","icon-ion-ios7-people","icon-ion-ios7-person","icon-ion-ios7-pie","icon-ion-ios7-printer","icon-ion-ios7-pulse-strong","icon-ion-ios7-rainy","icon-ion-ios7-search-strong","icon-ion-ios7-snowy","icon-ion-ios7-star","icon-ion-ios7-sunny","icon-ion-ios7-time","icon-ion-ios7-trash","icon-ion-ios7-unlocked","icon-ion-ios7-videocam","icon-ion-ipad","icon-ion-iphone","icon-ion-ipod","icon-ion-jet","icon-ion-key","icon-ion-knife","icon-ion-laptop","icon-ion-leaf","icon-ion-mouse","icon-ion-music-note","icon-ion-no-smoking","icon-ion-pizza","icon-ion-playstation","icon-ion-social-dropbox","icon-ion-social-usd","icon-ion-stats-bars","icon-ion-wifi","icon-ion-woman","icon-ion-wrench","icon-directions","icon-feather","icon-flashlight","icon-tools","icon-droplet","icon-hourglass","icon-cup","icon-rocket","icon-brush","icon-keyboard","icon-database","icon-clipboard","icon-graph","icon-archive"],static:{infiniteScrollItemsPerLoad:20},state:{blockedInput:!1,infiniteScrollLoading:!1},temp:{}};var Charts={filter:{timestamp:{start:0,end:Date.now()},account:""},filterFunc:{timestamp:function(e){return Charts.filter.timestamp.start<=e.timestamp&&Charts.filter.timestamp.end>=e.timestamp},account:function(){return""===Charts.filter.account||Charts.filter.account==item.account},all:function(e){return Charts.filterFunc.timestamp(e)&&Charts.filterFunc.account(e)}},draw:function(){this.categoryPie(),this.weekdayBar()},categoryPie:function(){var e={labels:[],series:[]},t=0,i=db.queryAll("category",{sort:[["order","ASC"]]});$.each(i,function(i,n){var a=db.query("item",function(e){return 0==e.deleted&&e.price<0&&e.category===n.uniqueid&&Charts.filterFunc.all(e)});if(a.length>0){var o=e.labels.length;e.labels[o]=n.description,e.series[o]=0,$.each(a,function(t,i){e.series[o]+=i.price}),t+=e.series[o]}});var n={labelInterpolationFnc:function(i,n){return i+": "+Math.round(e.series[n]/t*100)+"%"},labelOffset:40};new Chartist.Pie(".exp-stats-pie",e,n)},weekdayBar:function(){var e={labels:[],series:[[0,0,0,0,0,0,0]]};e.labels=i18n.weekday;var t={high:50,low:-50},i=db.query("item",Charts.filterFunc.all);$.each(i,function(t,i){e.series[0][new Date(i.timestamp).getDay()]+=i.price}),$.each(e.series[0],function(e,i){t.high=i>t.high?i:t.high,t.low=i<t.low?i:t.low}),new Chartist.Bar(".exp-stats-weekday",e,t)}},DROPBOX_APP_KEY="sf6zic5mzuzi7k4";window.client=null;var ds=null,dsTable=null,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},expApp=new Framework7({init:!1,modalTitle:"ExpenSync",notificationCloseOnClick:!0}),$$=Dom7,leftView=expApp.addView(".view-left",{dynamicNavbar:!0}),mainView=expApp.addView(".view-main",{dynamicNavbar:!0}),db=new FileDB(window.globals.properties.appkey);db.setupDropbox(function(){db.isNew()&&createLocalDatabase(),initApp()});